<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频播放器</title>
    <style>
        #video-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background-color: black;
            border-radius: 10px;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #save-button, #change-button {
            position: absolute;
            bottom: 20px;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        #save-button {
            right: 20px;
            background-color: #00bcd4;
        }
        #change-button {
            left: 20px;
            background-color: #009688;
        }
        #select-api {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        #api-menu {
            display: none;
            position: absolute;
            top: 60px;
            left: 20px;
            background-color: #f1f1f1;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }
        #api-menu a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        #api-menu a:hover {
            background-color: #ddd;
        }
        #error-message {
            position: absolute;
            top: 20px;
            left: 20px;
            color: red;
            display: none;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video-player" controls></video>
    </div>
    <button id="save-button">保存视频</button>
    <button id="change-button">换一个</button>
    <button id="select-api">选择API</button>
    <div id="api-menu"></div>
    <div id="error-message">加载失败</div>

    <script>
        const apiUrl = 'video.json'; // 替换为你的API链接

        let currentIndex = 0;
        let apis = [];

        document.getElementById('select-api').addEventListener('click', function() {
            var menu = document.getElementById('api-menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        });

        function fetchApis() {
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    apis = data;
                    const menu = document.getElementById('api-menu');
                    menu.innerHTML = '';
                    apis.forEach((item, index) => {
                        const a = document.createElement('a');
                        a.href = '#';
                        a.textContent = item.name;
                        a.onclick = () => selectApi(index);
                        menu.appendChild(a);
                    });
                    document.getElementById('select-api').textContent = apis[0].name;
                    loadVideo(0);
                })
                .catch(error => {
                    document.getElementById('error-message').style.display = 'block';
                    console.error('Error fetching APIs:', error);
                });
        }

        function selectApi(index) {
            currentIndex = index;
            document.getElementById('select-api').textContent = apis[index].name;
            loadVideo(index);
        }

        function loadVideo(index) {
            const videoUrl = apis[index].url;
            fetch(videoUrl, { method: 'HEAD' }).then(response => {
                if (response.status === 302) {
                    const finalVideoUrl = response.headers.get('Location');
                    localStorage.setItem('finalVideoUrl', finalVideoUrl);
                } else {
                    localStorage.setItem('finalVideoUrl', videoUrl);
                }
                var videoPlayer = document.getElementById('video-player');
                videoPlayer.src = videoUrl;
            }).catch(() => {
                document.getElementById('error-message').style.display = 'block';
            });
        }

        document.getElementById('change-button').addEventListener('click', function() {
            if (apis.length === 0) return;
            const nextIndex = (currentIndex + 1) % apis.length;
            selectApi(nextIndex);
        });

        document.getElementById('save-button').addEventListener('click', function() {
            const finalVideoUrl = localStorage.getItem('finalVideoUrl');
            if (finalVideoUrl) {
                window.location.href = finalVideoUrl;
            }
        });

        fetchApis();
    </script>
</body>
</html>
